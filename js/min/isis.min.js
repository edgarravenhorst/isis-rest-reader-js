var IsisMember=function(a){"use strict";this.method=a.links[0].method,this.url=a.links[0].href,this.isReady=!1,this.onError=function(a){console.log("status: "+a.status+" | "+a.statusText+"\n message: ",a)}},IsisCollection=function(a){IsisMember.call(this,a),this.collectValOnReady=!1,this.extractOnReady=!1,this.initialized=!1,this.getValues=function(a){return this.initialized=!0,this.onReadyFunc=a||function(){},$ISIS.ajax(this.url,{format:"json"},function(a){this.isReady=!0,this.values=a.value;for(var b=function(a){a.collect=function(){this.collectValue(a)}},c=0;c<this.values.length;c++){var d=this.values[c];b(d)}this.extractOnReady&&this.extract(this.onExtractCompleteFunc),this.collectValOnReady&&this.collectValue(this.onCollectValCompleteFunc),this.onReadyFunc(a.value)}.bind(this)),this},this.extract=function(a){var b=this.values,c=[],d=0;if(!this.isReady)return this.initialized||this.getValues(),this.onExtractCompleteFunc=a,void(this.extractOnReady=!0);for(var e=function(e){c.push(e),d++,d==b.length&&a(c)},f=0;f<b.length;f++){var g=b[f];this.collectValue(g,e)}return this},this.collectValue=function(a,b){if(!this.isReady)return this.initialized||this.getValues(),this.onCollectValCompleteFunc=b,void(this.collectValOnReady=!0);var c=a;$ISIS.ajax(a.href,{format:"json"},function(d){a=$ISIS.extractMembers(d),a.rawdata=c,b(a)})}};IsisCollection.prototype=Object.create(IsisMember.prototype),IsisCollection.prototype.constructor=IsisCollection;var IsisAction=function(a){"use strict";IsisMember.call(this,a),this.invokeReadyFunc=function(){},this.doInvokeOnReady=!1,this.prepare=function(){$ISIS.ajax(this.url,{format:"json"},function(a){this.rawdata=a,this.requiredParams=a.parameters,this.isReady=!0,this.doInvokeOnReady&&this.invoke(this.invokeParams,this.invokeReadyFunc)}.bind(this),this.onError)},this.invoke=function(a,b){return this.invokeParams=a,this.invokeReadyFunc=b,this.isReady?void $ISIS.ajax(this.url+"/invoke",{format:"json",method:this.rawdata.links[2].method,params:a},this.result.bind(this),function(a){400==a.status&&console.log("required parameters: ",this.requiredParams),this.onError(a)}.bind(this)):void(this.doInvokeOnReady=!0)},this.result=function(a){if(!a.result.value)return void this.invokeReadyFunc(a);var b=function(a){var b=$ISIS.extractMembers(a);this.invokeReadyFunc(b)};for(var c in a.result.value){var d=a.result.value[c];$ISIS.ajax(d.href,{format:"json"},b.bind(this))}},this.prepare()};IsisAction.prototype=Object.create(IsisMember.prototype),IsisAction.prototype.constructor=IsisAction;var ISIS=function(){"use strict";this.settings={baseurl:"http://xtalus.apps.gedge.nl/simple/restful/",method:"GET"},this.init=function(a){this.onReadyFunc=a||function(){},this.ajax(this.settings.baseurl,{format:"json"},function(a){var b=this.extractMembers(a);this.onReadyFunc(b)}.bind(this))},this.extractMembers=function(a){if(a.members){var b=a.members,c={};for(var d in b){var e,f=b[d];switch(f.memberType){case"collection":e=new IsisCollection(f);break;case"action":e=new IsisAction(f);break;default:e=f.value}c[d]=e}return c}},this.setCookie=function(a,b,c){var d=new Date;d.setTime(d.getTime()+24*c*60*60*1e3);var e="expires="+d.toUTCString();document.cookie=a+"="+b+"; "+e},this.getCookie=function(a){for(var b=a+"=",c=document.cookie.split(";"),d=0;d<c.length;d++){for(var e=c[d];" "==e.charAt(0);)e=e.substring(1);if(0===e.indexOf(b))return e.substring(b.length,e.length)}return""},this.deleteCookie=function(a){var b=new Date;b.setDate(b.getDate()-1),document.cookie=escape(a)+"=;expires="+b}},$ISIS=$ISIS||new ISIS;ISIS.prototype.ajax=function(a,b,c,d){"use strict";if("string"!=typeof a)return!1;b.method=b.method||"GET",b.headers=b.headers||{},b.format=b.format||"",b.params=b.params||null;var e=new XMLHttpRequest;e.onreadystatechange=function(){if(e.readyState==XMLHttpRequest.DONE)if(200==e.status){var a=e.responseText;"json"==b.format&&(a=JSON.parse(a)),c&&c(a)}else 400==e.status?(console.log("There was an error 400"),d&&d(e)):401==e.status?(console.log("Unauthorized"),d&&d(e)):(console.log("something else other than 200 was returned"),d&&d(e))};var f="";for(var g in b.params)f+=""!==f?"&":"?",f+=g+"="+encodeURIComponent(b.params[g]);e.open(b.method,a+f,!0),e.setRequestHeader("Content-Type","application/json; charset=utf-8");var h=$ISIS.getCookie("auth");""!==h&&($ISIS.authHeader=h),b.headers.Authorization&&($ISIS.authHeader=b.headers.Authorization),$ISIS.authHeader&&e.setRequestHeader("Authorization",$ISIS.authHeader),"GET"===b.method,e.send()},ISIS.prototype.auth={login:function(a,b,c){"use strict";var d={};$ISIS.ajax("http://xtalus.apps.gedge.nl/simple/restful/user?time="+(new Date).getTime(),{method:"get",headers:{Authorization:"Basic "+this.base64.encode(a+":"+b)}},function(e){$ISIS.setCookie("auth","Basic "+$ISIS.auth.base64.encode(a+":"+b),5),d={success:a===e.userName},c(d)},function(a){d.message="Gebruikersnaam of wachtwoord is niet juist",c(d)})},logout:function(){$ISIS.deleteCookie("auth")},base64:{encode:function(a){"use strict";var b,c,d,e,f,g="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",h="",i="",j="",k=0;do b=a.charCodeAt(k++),c=a.charCodeAt(k++),i=a.charCodeAt(k++),d=b>>2,e=(3&b)<<4|c>>4,f=(15&c)<<2|i>>6,j=63&i,isNaN(c)?f=j=64:isNaN(i)&&(j=64),h=h+g.charAt(d)+g.charAt(e)+g.charAt(f)+g.charAt(j),b=c=i="",d=e=f=j="";while(k<a.length);return h},decode:function(a){var b,c,d,e,f,g="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",h="",i="",j="",k=0,l=/[^A-Za-z0-9\+\/\=]/g;l.exec(a)&&window.alert("There were invalid base64 characters in the input text.\nValid base64 characters are A-Z, a-z, 0-9, '+', '/',and '='\nExpect errors in decoding."),a=a.replace(/[^A-Za-z0-9\+\/\=]/g,"");do d=g.indexOf(a.charAt(k++)),e=g.indexOf(a.charAt(k++)),f=g.indexOf(a.charAt(k++)),j=g.indexOf(a.charAt(k++)),b=d<<2|e>>4,c=(15&e)<<4|f>>2,i=(3&f)<<6|j,h+=String.fromCharCode(b),64!=f&&(h+=String.fromCharCode(c)),64!=j&&(h+=String.fromCharCode(i)),b=c=i="",d=e=f=j="";while(k<a.length);return h}}};
