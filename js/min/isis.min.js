(function(){"use strict";function a(a){return"function"==typeof a||"object"==typeof a&&null!==a}function b(a){return"function"==typeof a}function c(a){return"object"==typeof a&&null!==a}function d(a,b){X[Q]=a,X[Q+1]=b,Q+=2,2===Q&&O()}function e(){var a=process.nextTick,b=process.versions.node.match(/^(?:(\d+)\.)?(?:(\d+)\.)?(\*|\d+)$/);return Array.isArray(b)&&"0"===b[1]&&"10"===b[2]&&(a=setImmediate),function(){a(j)}}function f(){return function(){N(j)}}function g(){var a=0,b=new U(j),c=document.createTextNode("");return b.observe(c,{characterData:!0}),function(){c.data=a=++a%2}}function h(){var a=new MessageChannel;return a.port1.onmessage=j,function(){a.port2.postMessage(0)}}function i(){return function(){setTimeout(j,1)}}function j(){for(var a=0;Q>a;a+=2){var b=X[a],c=X[a+1];b(c),X[a]=void 0,X[a+1]=void 0}Q=0}function k(){try{var a=require,b=a("vertx");return N=b.runOnLoop||b.runOnContext,f()}catch(c){return i()}}function l(){}function m(){return new TypeError("You cannot resolve a promise with itself")}function n(){return new TypeError("A promises callback cannot return that same promise.")}function o(a){try{return a.then}catch(b){return _.error=b,_}}function p(a,b,c,d){try{a.call(b,c,d)}catch(e){return e}}function q(a,b,c){R(function(a){var d=!1,e=p(c,b,function(c){d||(d=!0,b!==c?t(a,c):v(a,c))},function(b){d||(d=!0,w(a,b))},"Settle: "+(a._label||" unknown promise"));!d&&e&&(d=!0,w(a,e))},a)}function r(a,b){b._state===Z?v(a,b._result):b._state===$?w(a,b._result):x(b,void 0,function(b){t(a,b)},function(b){w(a,b)})}function s(a,c){if(c.constructor===a.constructor)r(a,c);else{var d=o(c);d===_?w(a,_.error):void 0===d?v(a,c):b(d)?q(a,c,d):v(a,c)}}function t(b,c){b===c?w(b,m()):a(c)?s(b,c):v(b,c)}function u(a){a._onerror&&a._onerror(a._result),y(a)}function v(a,b){a._state===Y&&(a._result=b,a._state=Z,0!==a._subscribers.length&&R(y,a))}function w(a,b){a._state===Y&&(a._state=$,a._result=b,R(u,a))}function x(a,b,c,d){var e=a._subscribers,f=e.length;a._onerror=null,e[f]=b,e[f+Z]=c,e[f+$]=d,0===f&&a._state&&R(y,a)}function y(a){var b=a._subscribers,c=a._state;if(0!==b.length){for(var d,e,f=a._result,g=0;g<b.length;g+=3)d=b[g],e=b[g+c],d?B(c,d,e,f):e(f);a._subscribers.length=0}}function z(){this.error=null}function A(a,b){try{return a(b)}catch(c){return aa.error=c,aa}}function B(a,c,d,e){var f,g,h,i,j=b(d);if(j){if(f=A(d,e),f===aa?(i=!0,g=f.error,f=null):h=!0,c===f)return void w(c,n())}else f=e,h=!0;c._state!==Y||(j&&h?t(c,f):i?w(c,g):a===Z?v(c,f):a===$&&w(c,f))}function C(a,b){try{b(function(b){t(a,b)},function(b){w(a,b)})}catch(c){w(a,c)}}function D(a,b){var c=this;c._instanceConstructor=a,c.promise=new a(l),c._validateInput(b)?(c._input=b,c.length=b.length,c._remaining=b.length,c._init(),0===c.length?v(c.promise,c._result):(c.length=c.length||0,c._enumerate(),0===c._remaining&&v(c.promise,c._result))):w(c.promise,c._validationError())}function E(a){return new ba(this,a).promise}function F(a){function b(a){t(e,a)}function c(a){w(e,a)}var d=this,e=new d(l);if(!P(a))return w(e,new TypeError("You must pass an array to race.")),e;for(var f=a.length,g=0;e._state===Y&&f>g;g++)x(d.resolve(a[g]),void 0,b,c);return e}function G(a){var b=this;if(a&&"object"==typeof a&&a.constructor===b)return a;var c=new b(l);return t(c,a),c}function H(a){var b=this,c=new b(l);return w(c,a),c}function I(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function J(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function K(a){this._id=ga++,this._state=void 0,this._result=void 0,this._subscribers=[],l!==a&&(b(a)||I(),this instanceof K||J(),C(this,a))}function L(){var a;if("undefined"!=typeof global)a=global;else if("undefined"!=typeof self)a=self;else try{a=Function("return this")()}catch(b){throw new Error("polyfill failed because global object is unavailable in this environment")}var c=a.Promise;(!c||"[object Promise]"!==Object.prototype.toString.call(c.resolve())||c.cast)&&(a.Promise=ha)}var M;M=Array.isArray?Array.isArray:function(a){return"[object Array]"===Object.prototype.toString.call(a)};var N,O,P=M,Q=0,R=({}.toString,d),S="undefined"!=typeof window?window:void 0,T=S||{},U=T.MutationObserver||T.WebKitMutationObserver,V="undefined"!=typeof process&&"[object process]"==={}.toString.call(process),W="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,X=new Array(1e3);O=V?e():U?g():W?h():void 0===S&&"function"==typeof require?k():i();var Y=void 0,Z=1,$=2,_=new z,aa=new z;D.prototype._validateInput=function(a){return P(a)},D.prototype._validationError=function(){return new Error("Array Methods must be provided an Array")},D.prototype._init=function(){this._result=new Array(this.length)};var ba=D;D.prototype._enumerate=function(){for(var a=this,b=a.length,c=a.promise,d=a._input,e=0;c._state===Y&&b>e;e++)a._eachEntry(d[e],e)},D.prototype._eachEntry=function(a,b){var d=this,e=d._instanceConstructor;c(a)?a.constructor===e&&a._state!==Y?(a._onerror=null,d._settledAt(a._state,b,a._result)):d._willSettleAt(e.resolve(a),b):(d._remaining--,d._result[b]=a)},D.prototype._settledAt=function(a,b,c){var d=this,e=d.promise;e._state===Y&&(d._remaining--,a===$?w(e,c):d._result[b]=c),0===d._remaining&&v(e,d._result)},D.prototype._willSettleAt=function(a,b){var c=this;x(a,void 0,function(a){c._settledAt(Z,b,a)},function(a){c._settledAt($,b,a)})};var ca=E,da=F,ea=G,fa=H,ga=0,ha=K;K.all=ca,K.race=da,K.resolve=ea,K.reject=fa,K.prototype={constructor:K,then:function(a,b){var c=this,d=c._state;if(d===Z&&!a||d===$&&!b)return this;var e=new this.constructor(l),f=c._result;if(d){var g=arguments[d-1];R(function(){B(d,e,g,f)})}else x(c,e,a,b);return e},"catch":function(a){return this.then(null,a)}};var ia=L,ja={Promise:ha,polyfill:ia};"function"==typeof define&&define.amd?define(function(){return ja}):"undefined"!=typeof module&&module.exports?module.exports=ja:"undefined"!=typeof this&&(this.ES6Promise=ja),ia()}).call(this);var IsisMember=function(a){"use strict";this.method=a.links[0].method,this.url=a.links[0].href,this.isReady=!1,this.onError=function(a){return console.log("status: "+a.status+" | "+a.statusText+"\n message: ",a),a}},IsisCollection=function(a){"use strict";IsisMember.call(this,a),this.getValues=function(){var a=this;return $ISIS.ajax(this.url).then(function(b){for(var c=b.value,d=0;d<c.length;d++)a.initValue(c[d]);return c})},this.initValue=function(a){a.collect=function(){return this.collectValue(a)}.bind(this)},this.extract=function(){return this.getValues().then(function(a){for(var b=[],c=0;c<a.length;c++)b.push(a[c].collect());return Promise.all(b)})},this.collectValue=function(a){var b=a;return $ISIS.ajax(a.href).then(function(c){return a=$ISIS.extractMembers(c),a.rawdata=b,a})}};IsisCollection.prototype=Object.create(IsisMember.prototype),IsisCollection.prototype.constructor=IsisCollection;var IsisAction=function(a){"use strict";IsisMember.call(this,a),this.invoke=function(a){var b=this;return this.prepare().then(function(c){return $ISIS.ajax(b.url+"/invoke",{method:c.links[2].method,params:a})}).then(this.result)["catch"](function(a){400==a.status&&console.log("required parameters: ",this.requiredParams),this.onError(a)})},this.prepare=function(){return $ISIS.ajax(this.url,{},function(a){this.rawdata=a,this.requiredParams=a.parameters}.bind(this),this.onError)},this.result=function(a){return new Promise(function(b,c){if(!a.result.value)return void b(a);var d=[];for(var e in a.result.value){var f=a.result.value[e];d.push($ISIS.ajax(f.href))}Promise.all(d).then(function(a){if(1===a.length)b($ISIS.extractMembers(a[0]));else{var c=[];for(var d in a)c.push($ISIS.extractMembers(a[d]));b(c)}})})}};IsisAction.prototype=Object.create(IsisMember.prototype),IsisAction.prototype.constructor=IsisAction;var ISIS=function(){"use strict";this.settings={baseurl:"http://xtalus.apps.gedge.nl/simple/restful/",method:"GET"},this.init=function(a){return a=a||this.settings.baseurl,this.ajax(a).then(function(a){return new Promise(function(b,c){var d=$ISIS.extractMembers(a);b(d)})}.bind(this))},this.extractMembers=function(a){if(a.members){var b=a.members,c={};for(var d in b){var e,f=b[d];switch(f.memberType){case"collection":e=new IsisCollection(f);break;case"action":e=new IsisAction(f);break;default:e=f.value}c[d]=e}return c}},this.setCookie=function(a,b,c){var d=new Date;d.setTime(d.getTime()+24*c*60*60*1e3);var e="expires="+d.toUTCString();document.cookie=a+"="+b+"; "+e},this.getCookie=function(a){for(var b=a+"=",c=document.cookie.split(";"),d=0;d<c.length;d++){for(var e=c[d];" "==e.charAt(0);)e=e.substring(1);if(0===e.indexOf(b))return e.substring(b.length,e.length)}return""},this.deleteCookie=function(a){var b=new Date;b.setDate(b.getDate()-1),document.cookie=escape(a)+"=;expires="+b}},$ISIS=$ISIS||new ISIS;ISIS.prototype.ajax=function(a,b,c,d){"use strict";return new Promise(function(e,f){if("string"!=typeof a)return!1;b=b||{},b.method=b.method||"GET",b.headers=b.headers||{},b.format=b.format||"json",b.params=b.params||null;var g=new XMLHttpRequest;g.onreadystatechange=function(){if(g.readyState==XMLHttpRequest.DONE)if(200==g.status){var a=g.responseText;"json"==b.format&&(a=JSON.parse(a)),c&&c(a),e(a)}else 400==g.status?(console.log("There was an error 400"),d&&d(g),f(g)):401==g.status?(console.log("Unauthorized"),d&&d(g),f(g)):(console.log("something else other than 200 was returned"),d&&d(g),f(g))};var h="";for(var i in b.params)h+=""!==h?"&":"?",h+=i+"="+encodeURIComponent(b.params[i]);g.open(b.method,a+h,!0),g.setRequestHeader("Content-Type","application/json; charset=utf-8");var j=$ISIS.getCookie("auth");""!==j&&($ISIS.authHeader=j),b.headers.Authorization&&($ISIS.authHeader=b.headers.Authorization),$ISIS.authHeader&&g.setRequestHeader("Authorization",$ISIS.authHeader),"GET"===b.method,g.send()})},ISIS.prototype.auth={login:function(a,b,c){"use strict";var d={};$ISIS.ajax("http://xtalus.apps.gedge.nl/simple/restful/user?time="+(new Date).getTime(),{method:"get",headers:{Authorization:"Basic "+this.base64.encode(a+":"+b)}},function(e){$ISIS.setCookie("auth","Basic "+$ISIS.auth.base64.encode(a+":"+b),5),d={success:a===e.userName},c(d)},function(a){d.message="Gebruikersnaam of wachtwoord is niet juist",c(d)})},logout:function(){$ISIS.deleteCookie("auth")},base64:{encode:function(a){"use strict";var b,c,d,e,f,g="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",h="",i="",j="",k=0;do b=a.charCodeAt(k++),c=a.charCodeAt(k++),i=a.charCodeAt(k++),d=b>>2,e=(3&b)<<4|c>>4,f=(15&c)<<2|i>>6,j=63&i,isNaN(c)?f=j=64:isNaN(i)&&(j=64),h=h+g.charAt(d)+g.charAt(e)+g.charAt(f)+g.charAt(j),b=c=i="",d=e=f=j="";while(k<a.length);return h},decode:function(a){var b,c,d,e,f,g="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",h="",i="",j="",k=0,l=/[^A-Za-z0-9\+\/\=]/g;l.exec(a)&&window.alert("There were invalid base64 characters in the input text.\nValid base64 characters are A-Z, a-z, 0-9, '+', '/',and '='\nExpect errors in decoding."),a=a.replace(/[^A-Za-z0-9\+\/\=]/g,"");do d=g.indexOf(a.charAt(k++)),e=g.indexOf(a.charAt(k++)),f=g.indexOf(a.charAt(k++)),j=g.indexOf(a.charAt(k++)),b=d<<2|e>>4,c=(15&e)<<4|f>>2,i=(3&f)<<6|j,h+=String.fromCharCode(b),64!=f&&(h+=String.fromCharCode(c)),64!=j&&(h+=String.fromCharCode(i)),b=c=i="",d=e=f=j="";while(k<a.length);return h}}};
